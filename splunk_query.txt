[Total_Builds]
search index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" 
host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ("IMS_7_8_MAIN")
| fillnull value="-" metadata.branchName
| search metadata.branchName IN ("IMS_7_8_MAIN")
| stats count as total_builds


[Successful_Builds]
search index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" 
host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ("IMS_7_8_MAIN")
| fillnull value="-" metadata.branchName
| search metadata.branchName IN ("IMS_7_8_MAIN")
| stats count(eval(job_result=="SUCCESS")) as successful_builds


[Failed_Builds]
search index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" 
host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ("IMS_7_8_MAIN")
| fillnull value="-" metadata.branchName
| search metadata.branchName IN ("IMS_7_8_MAIN")
| stats count(eval(job_result=="FAILURE")) as failed_builds


[Unstable_Builds]
search index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" 
host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ("IMS_7_8_MAIN")
| fillnull value="-" metadata.branchName
| search metadata.branchName IN ("IMS_7_8_MAIN")
| stats count(eval(job_result=="UNSTABLE")) as unstable_builds


[Aborted_Builds]
search index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" 
host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ("IMS_7_8_MAIN")
| fillnull value="-" metadata.branchName
| search metadata.branchName IN ("IMS_7_8_MAIN")
| stats count(eval(job_result=="ABORTED")) as aborted_builds

[Table_format]
search (index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ("IMS_7_8_MAIN")) OR
(index="jenkins_statistics" source="/job_event" sourcetype="json:jenkins" host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" type="completed" metadata.branchName IN ("IMS_7_8_MAIN"))
| stats values(*) as * by job_name build_number
| fillnull value="-" metadata.status
| stats count as total_builds, 
    count(eval(job_result=="SUCCESS")) as successful_builds, 
    count(eval(job_result=="FAILURE")) as failed_builds, 
    count(eval(job_result=="ABORTED")) as aborted_builds, 
    count(eval(job_result=="UNSTABLE")) as unstable_builds, 
    avg(job_duration) as average_job_duration by metadata.branchName
| eval failure_percentage=round(((failed_builds+unstable_builds)/total_builds)*100,2)
| eval aborted_percentage=round(((aborted_builds)/total_builds)*100,2)
| eval rounded_average_job_duration = round(average_job_duration, 2)
| eval average_job_duration_in_hhmmss=tostring(rounded_average_job_duration, "duration")
| sort -failure_percentage, -total_builds
| table metadata.branchName total_builds successful_builds failed_builds aborted_builds unstable_builds aborted_percentage failure_percentage average_job_duration_in_hhmmss
| rename metadata.branchName as "Branch", 
    total_builds as "Total Builds", 
    successful_builds as "Successful Builds", 
    failed_builds as "Failed Builds", 
    aborted_builds as "Aborted Builds", 
    unstable_builds as "Unstable Builds", 
    aborted_percentage as "Aborted %", 
    failure_percentage as "Failed or Unstable%", 
    average_job_duration_in_hhmmss as "Average Build Duration"
| addcoltotals labelfield="Branch" label="Total" 
    "Total Builds" "Successful Builds" "Failed Builds" "Aborted Builds" "Unstable Builds"


[Table_format_dynamically]
search (index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ("IMS_7_8_MAIN", "IMS_7_7_MAIN", "IMS_7_6_MAIN", "IMS_7_4_1_MAIN")) OR
(index="jenkins_statistics" source="/job_event" sourcetype="json:jenkins" host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" type="completed" metadata.branchName IN ("IMS_7_8_MAIN", "IMS_7_7_MAIN", "IMS_7_6_MAIN", "IMS_7_4_1_MAIN"))
| stats values(*) as * by job_name build_number
| fillnull value="-" metadata.status
| stats count as total_builds, 
    count(eval(job_result=="SUCCESS")) as successful_builds, 
    count(eval(job_result=="FAILURE")) as failed_builds, 
    count(eval(job_result=="ABORTED")) as aborted_builds, 
    count(eval(job_result=="UNSTABLE")) as unstable_builds, 
    avg(job_duration) as average_job_duration by metadata.branchName
| eval failure_percentage=round(((failed_builds+unstable_builds)/total_builds)*100,2)
| eval aborted_percentage=round(((aborted_builds)/total_builds)*100,2)
| eval rounded_average_job_duration = round(average_job_duration, 2)
| eval average_job_duration_in_hhmmss=tostring(rounded_average_job_duration, "duration")
| sort -failure_percentage, -total_builds
| table metadata.branchName total_builds successful_builds failed_builds aborted_builds unstable_builds aborted_percentage failure_percentage average_job_duration_in_hhmmss
| rename metadata.branchName as "Branch", 
    total_builds as "Total Builds", 
    successful_builds as "Successful Builds", 
    failed_builds as "Failed Builds", 
    aborted_builds as "Aborted Builds", 
    unstable_builds as "Unstable Builds", 
    aborted_percentage as "Aborted %", 
    failure_percentage as "Failed or Unstable%", 
    average_job_duration_in_hhmmss as "Average Build Duration"
| addcoltotals labelfield="Branch" label="Total" 
    "Total Builds" "Successful Builds" "Failed Builds" "Aborted Builds" "Unstable Builds"


[Dynamic_Total_Builds]
search index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" 
host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ($BRANCH_NAMES)
| fillnull value="-" metadata.branchName
| stats count as total_builds




[dynamically]
search (index="jenkins" event_tag="build_summary" sourcetype="json:jenkins" host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" metadata.branchName IN ($BRANCH_NAMES)) OR
(index="jenkins_statistics" source="/job_event" sourcetype="json:jenkins" host="jenkins.service.ntd.ciscolabs.com" job_name="USM/*" type="completed" metadata.branchName IN ($BRANCH_NAMES))
| stats values(*) as * by job_name build_number
| fillnull value="-" metadata.status
| stats count as total_builds, 
    count(eval(job_result=="SUCCESS")) as successful_builds, 
    count(eval(job_result=="FAILURE")) as failed_builds, 
    count(eval(job_result=="ABORTED")) as aborted_builds, 
    count(eval(job_result=="UNSTABLE")) as unstable_builds, 
    avg(job_duration) as average_job_duration by metadata.branchName
| eval failure_percentage=round(((failed_builds+unstable_builds)/total_builds)*100,2)
| eval aborted_percentage=round(((aborted_builds)/total_builds)*100,2)
| eval rounded_average_job_duration = round(average_job_duration, 2)
| eval average_job_duration_in_hhmmss=tostring(rounded_average_job_duration, "duration")
| sort -failure_percentage, -total_builds
| table metadata.branchName total_builds successful_builds failed_builds aborted_builds unstable_builds aborted_percentage failure_percentage average_job_duration_in_hhmmss
| rename metadata.branchName as "Branch", 
    total_builds as "Total Builds", 
    successful_builds as "Successful Builds", 
    failed_builds as "Failed Builds", 
    aborted_builds as "Aborted Builds", 
    unstable_builds as "Unstable Builds", 
    aborted_percentage as "Aborted %", 
    failure_percentage as "Failed or Unstable%", 
    average_job_duration_in_hhmmss as "Average Build Duration"
| addcoltotals labelfield="Branch" label="Total" 
    "Total Builds" "Successful Builds" "Failed Builds" "Aborted Builds" "Unstable Builds"